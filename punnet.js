/** Andrew Staroscik 2012
  * SciencePrimer.com
  * 
  * multi-trait punnett square generator
  *
  **/

(function(a){function v(){if(document.getElementById("T1none")){a("#T1none").change(function(){dominantTraitArray[1]=0;h()})}if(document.getElementById("T10")){a("#T10").change(function(){dominantTraitArray[1]=alleleListenerList["T10"];h()})}if(document.getElementById("T11")){a("#T11").change(function(){dominantTraitArray[1]=alleleListenerList["T11"];h()})}if(document.getElementById("T12")){a("#T12").change(function(){dominantTraitArray[1]=alleleListenerList["T12"];h()})}if(document.getElementById("T13")){a("#T13").change(function(){dominantTraitArray[1]=alleleListenerList["T13"];h()})}if(document.getElementById("T2none")){a("#T2none").change(function(){dominantTraitArray[2]=0;h()})}if(document.getElementById("T20")){a("#T20").change(function(){dominantTraitArray[2]=alleleListenerList["T20"];h()})}if(document.getElementById("T21")){a("#T21").change(function(){dominantTraitArray[2]=alleleListenerList["T21"];h()})}if(document.getElementById("T22")){a("#T22").change(function(){dominantTraitArray[2]=alleleListenerList["T22"];h()})}if(document.getElementById("T23")){a("#T23").change(function(){dominantTraitArray[2]=alleleListenerList["T23"];h()})}if(document.getElementById("T3none")){a("#T3none").change(function(){dominantTraitArray[3]=0;h()})}if(document.getElementById("T30")){a("#T30").change(function(){dominantTraitArray[3]=alleleListenerList["T30"];h()})}if(document.getElementById("T31")){a("#T31").change(function(){dominantTraitArray[3]=alleleListenerList["T31"];h()})}if(document.getElementById("T32")){a("#T32").change(function(){dominantTraitArray[3]=alleleListenerList["T32"];h()})}if(document.getElementById("T33")){a("#T33").change(function(){dominantTraitArray[3]=alleleListenerList["T33"];h()})}if(document.getElementById("T4none")){a("#T4none").change(function(){dominantTraitArray[4]=0;h()})}if(document.getElementById("T40")){a("#T40").change(function(){dominantTraitArray[4]=alleleListenerList["T40"];h()})}if(document.getElementById("T41")){a("#T41").change(function(){dominantTraitArray[4]=alleleListenerList["T41"];h()})}if(document.getElementById("T42")){a("#T42").change(function(){dominantTraitArray[4]=alleleListenerList["T42"];h()})}if(document.getElementById("T43")){a("#T43").change(function(){dominantTraitArray[4]=alleleListenerList["T43"];h()})}if(document.getElementById("T5none")){a("#T5none").change(function(){dominantTraitArray[5]=0;h()})}if(document.getElementById("T50")){a("#T50").change(function(){dominantTraitArray[5]=alleleListenerList["T50"];h()})}if(document.getElementById("T51")){a("#T51").change(function(){dominantTraitArray[5]=alleleListenerList["T51"];h()})}if(document.getElementById("T52")){a("#T52").change(function(){dominantTraitArray[5]=alleleListenerList["T52"];h()})}if(document.getElementById("T53")){a("#T53").change(function(){dominantTraitArray[5]=alleleListenerList["T53"];h()})}}function u(a,b){var c=a}function t(){var a=document.getElementById("dominanceOptions"),c,d=1,e="",f="",g="",h=[],i=[],j=[],k=[];while(a.hasChildNodes())a.removeChild(a.firstChild);for(var l=1;l<=b;l+=1){f="";f=f+l+"1";h.length=0;h.push(parentAlleles1[f]);addAllel=1;for(var m=0;m<h.length;m+=1){f=""+l+"2";if(parentAlleles1[f]==h[m]){addAllel=0}}if(addAllel==1){h.push(parentAlleles1[f])}addAllel=1;for(var m=0;m<h.length;m+=1){f=""+l+"1";if(parentAlleles2[f]==h[m]){addAllel=0}}if(addAllel==1){h.push(parentAlleles2[f])}addAllel=1;for(var m=0;m<h.length;m+=1){f=""+l+"2";if(parentAlleles2[f]==h[m]){addAllel=0}}if(addAllel==1){h.push(parentAlleles2[f])}c=document.createElement("span");c.innerHTML="<br /> Trait "+l+" dominant allele: ";a.appendChild(c);c=document.createElement("input");c.setAttribute("id","T"+l+"none");c.setAttribute("type","radio");c.setAttribute("name",""+l);c.setAttribute("value","0");c.setAttribute("class","domRadioButtons");if(dominantTraitArray[l]==0){c.setAttribute("checked","checked")}a.appendChild(c);i.push("T"+l+"none");j.push(0);k.push(l);c=document.createElement("span");c.innerHTML=" None ";c.setAttribute("class","domRadioButtons");a.appendChild(c);for(var n=0;n<h.length;n+=1){c=document.createElement("input");c.setAttribute("id","T"+l+n);c.setAttribute("type","radio");c.setAttribute("name",""+l);c.setAttribute("value",h[n]);c.setAttribute("class","domRadioButtons");if(dominantTraitArray[l]==h[n]){c.setAttribute("checked","checked")}a.appendChild(c);alleleListenerList["T"+l+n]=h[n];i.push("T"+l+n);j.push(h[n]);k.push(l);c=document.createElement("span");c.innerHTML=" "+h[n]+" ";c.setAttribute("class","domRadioButtons");a.appendChild(c)}}v()}function s(){var a,c,d,e,f;for(var g=1;g<=5;g+=1){d="T"+g;e=document.getElementsByClassName(d);for(theDiv in e){if(e[theDiv].className==d){e[theDiv].style.display="none"}}}for(var g=1;g<=b;g+=1){for(var h=1;h<3;h+=1){f="p1t"+g+"a"+h;a=document.getElementById(f);c=g+""+h;c=parentAlleles1[c];a.value=c}}for(var g=1;g<=b;g+=1){for(var h=1;h<3;h+=1){f="p2t"+g+"a"+h;a=document.getElementById(f);c=g+""+h;c=parentAlleles2[c];a.value=c}}for(var g=1;g<=b;g+=1){d="T"+g;e=document.getElementsByClassName(d);for(theDiv in e){if(e[theDiv].className==d){e[theDiv].style.display="inline"}}}}function r(){var a="",c="",d="";theCross=document.getElementById("theCross");for(var e=1;e<=b;e+=1){for(var f=1;f<3;f+=1){d=e+""+f;a=a+parentAlleles1[d];c=c+parentAlleles2[d]}theCross.innerHTML=a+" &times; "+c}}function q(){var a=315/listOfCombinedGenotypes.length,b=65;for(var c=0;c<316;c+=a){colorArray.push("hsl("+Math.round(c)+", 100%, "+b+"%)")}}function p(a){if(a in genotypeRatios){genotypeRatios[a]+=1}else{genotypeRatios[a]=1}}function o(a,b,c,d){if(d!=0&&a.indexOf(d)>-1&&c.indexOf(d)>-1&&showPhenotypeOrGenotype=="phenotype"){return 1}else{if(a==c||b==c){return 1}else{return 0}}}function n(a){var c,d,e,f,g,h="",i=1,j=0,k=0,l=a.length,m=[];if(listOfCombinedGenotypes.length==0){listOfCombinedGenotypes.push(a);properColorForCellArray.push(0);p(listOfCombinedGenotypes[0]);return}for(var n=0;n<listOfCombinedGenotypes.length;n+=1){i=1;for(var q=0;q<l;q+=2){c=a.substr(q,1)+a.substr(q+1,1);d=a.substr(q+1,1)+a.substr(q,1);e=listOfCombinedGenotypes[n].substr(q,2);k+=o(c,d,e,dominantTraitArray[i]);i+=1;if(k==b){properColorForCellArray.push(n);p(listOfCombinedGenotypes[n]);return}}k=0}listOfCombinedGenotypes.push(a);properColorForCellArray.push(listOfCombinedGenotypes.length-1);p(listOfCombinedGenotypes[listOfCombinedGenotypes.length-1])}function m(a){var b=a.split(" ").join("");return b}function l(a,b){var c,d=1,e=a+b,f=b+a;e=m(e);f=m(f);if(possibleGenotypesArray.length==0){possibleGenotypesArray.push(e);d=0}else{for(var g=0;g<possibleGenotypesArray.length;g+=1){c=m(possibleGenotypesArray[g]);if(c==e||c==f){d=0;break}}}if(d==1){possibleGenotypesArray.push(e)}}function k(a){var b=0,c=1;if(listOfCombinedGenotypes.length==0){listOfCombinedGenotypes.push(a);c=0}else{for(i=0;i<listOfCombinedGenotypes.length;i+=1){b+=n(listOfCombinedGenotypes[i],a);if(b==0){c=0}}}if(b>=listOfCombinedGenotypes.length){listOfCombinedGenotypes.push(a)}}function j(){var a,d=0,f=document.getElementById("genotypeRatios"),g="There are "+listOfCombinedGenotypes.length+" distinct "+showPhenotypeOrGenotype+"s <br /><br />";while(f.hasChildNodes())f.removeChild(f.firstChild);if(e==1){for(genotype in genotypeRatios){if(showPercentOrRatio=="percent"){g="<span style= 'color: "+colorArray[d]+";'>"+g+genotype+": "+Math.round(1e3*genotypeRatios[genotype]/Math.pow(4,b))/10+" %</span><br />"}else{g="<span style= 'color: "+colorArray[d]+";'>"+g+genotype+": "+genotypeRatios[genotype]+" </span><br />"}d+=1}a=document.createElement("div");a.setAttribute("style","position: absolute; left:"+(c+2)*(Math.pow(2,b)+1)+"px; top: "+c*1+"px; width: 170px; text-align: right; border: solid 5px #232323; background-color: #232323;");a.innerHTML=g;f.appendChild(a)}}function h(){var a,d,e,f,g,h,i,k,m,o=0,p=0,u=0,v=0,w=0,x=0,y=0,z=0;allele=1,emHeight=1.5*b,traitArray=positioningArray[b];possibleGenotypesArray.length=0;listOfCombinedGenotypes.length=0;colorArray.length=0;boxContentArray.length=0;leftColumnContent.length=0;properColorForCellArray.length=0;genotypeRatios={};r();s();t();if((Math.pow(2,b)+1)*30>450){c=450/(Math.pow(2,b)+1)}else{c=(b+1)*(40/b)}emHeight=c/1.5;m=c/5;o=c+2;h=i=(c+2)*(2+Math.pow(2,b));document.getElementById("squarePositionDiv").style.width=h+"px";document.getElementById("squarePositionDiv").style.height=i+"px";a=document.getElementById("squareArea");while(a.hasChildNodes())a.removeChild(a.firstChild);for(var A=0;A<Math.pow(2,b);A+=1){f="";for(var B=0;B<b;B+=1){f=f+""+parentAlleles1[traitArray[w]];w+=1}d=document.createElement("div");d.setAttribute("style","position: absolute; left:"+o+"px; top: "+p+"px ; width:"+c+"px; height: "+c+"px; font-size: "+m+"px; text-align: center; line-height: "+emHeight+"px; border: solid 1px #ffffff;");d.innerHTML=f;a.appendChild(d);o+=c+1}w=0;for(var C=0;C<Math.pow(2,b);C+=1){x=0;g="";for(var B=0;B<b;B+=1){g=g+""+parentAlleles2[traitArray[w]];w+=1}leftColumnContent.push(g);for(var D=0;D<Math.pow(2,b);D+=1){y=z;f="";for(var B=0;B<b;B+=1){l(parentAlleles1[traitArray[x]],parentAlleles2[traitArray[y]]);f=f+""+parentAlleles1[traitArray[x]]+parentAlleles2[traitArray[y]];x+=1;y+=1}n(f);boxContentArray.push(f)}z+=b}q();p+=c+1;w=0;for(var C=0;C<Math.pow(2,b);C+=1){o=0;d=document.createElement("div");d.setAttribute("style","position: absolute; left:"+o+"px; top: "+p+"px ; width:"+c+"px; height: "+c+"px; font-size: "+m+"px; text-align: center; line-height: "+emHeight+"px; border: solid 1px #ffffff;");d.innerHTML=leftColumnContent[v];v+=1;a.appendChild(d);o+=c+1;for(var D=0;D<Math.pow(2,b);D+=1){d=document.createElement("div");d.setAttribute("style","position: absolute; left:"+o+"px; top: "+p+"px ; width:"+c+"px; height: "+c+"px; font-size: "+m+"px; text-align: center; line-height: "+emHeight+"px; border: solid 1px #000000; background-color: "+colorArray[properColorForCellArray[u]]+";");d.innerHTML=boxContentArray[u];u+=1;a.appendChild(d);o+=c+1}p+=c+1;z+=b}j()}function g(c){a("#slider").slider({range:"max",min:1,max:c,value:b,slide:function(c,d){a("#amount").val(d.value);b=d.value;f=1;h()}})}var b=2,c=20*b,d=0,e=0,f=1;currentColor="hsl(0,100%, 85%)",showPhenotypeOrGenotype="phenotype",showPercentOrRatio="percent",traits1=["11","12"],traits2=["11","21","11","22","12","21","12","22"],traits3=["11","21","31","11","21","32","11","22","31","11","22","32","12","21","31","12","21","32","12","22","31","12","22","32"],traits4=["11","21","31","41","11","21","31","42","11","21","32","41","11","22","31","41","11","21","32","42","11","22","32","41","11","22","31","42","11","22","32","42","12","21","31","41","12","21","31","42","12","21","32","41","12","22","31","41","12","21","32","42","12","22","32","41","12","22","31","42","12","22","32","42"],traits5=["11", "21", "31", "41", "51", "11", "21", "31", "41", "52", "11", "21", "31", "42", "51", "11", "21", "32", "41", "51", "11", "22", "31", "41", "51", "11", "21", "31", "42", "52", "11", "21", "32", "42", "51", "11", "21", "32", "41", "52", "11", "22", "31", "41", "52", "11", "22", "31", "42", "51", "11", "22", "32", "41", "51", "11", "21", "32", "42", "52", "11", "22", "31", "42", "52", "11", "22", "32", "41", "52", "11", "22", "32", "42", "51", "11", "22", "32", "42", "52", "12", "21", "31", "41", "51", "12", "21", "31", "41", "52", "12", "21", "31", "42", "51", "12", "21", "32", "41", "51", "12", "22", "31", "41", "51", "12", "21", "31", "42", "52", "12", "21", "32", "42", "51", "12", "21", "32", "41", "52", "12", "22", "31", "41", "52", "12", "22", "31", "42", "51", "12", "22", "32", "41", "51", "12", "21", "32", "42", "52", "12", "22", "31", "42", "52", "12", "22", "32", "41", "52", "12", "22", "32", "42", "51", "12", "22", "32", "42", "52"],positioningArray=[d,traits1,traits2,traits3,traits4,traits5],parentAlleles1={11:"A",12:"a",21:"B",22:"b",31:"C",32:"c",41:"D",42:"d",51:"E",52:"e",61:"F",62:"f"},parentAlleles2={11:"A",12:"a",21:"B",22:"b",31:"C",32:"c",41:"D",42:"d",51:"E",52:"e",61:"F",62:"f"},dominantTraitArray=[0,0,0,0,0,0],genotypeRatios={},alleleListenerList={T10:0,T11:0,T12:0,T13:0,T20:0,T21:0,T22:0,T23:0,T30:0,T31:0,T32:0,T33:0,T40:0,T41:0,T42:0,T43:0,T50:0,T51:0,T52:0,T53:0},possibleGenotypesArray=[],listOfCombinedGenotypes=[],colorArray=[],boxContentArray=[],leftColumnContent=[],properColorForCellArray=[];a("document").ready(function(){g(5);h()});a("#phenotypeButton").change(function(){showPhenotypeOrGenotype="phenotype";h()});a("#genotypeButton").change(function(){showPhenotypeOrGenotype="genotype";h()});a("#percentButton").change(function(){showPercentOrRatio="percent";h()});a("#ratioButton").change(function(){showPercentOrRatio="ratio";h()});a("#p1t1a1").keyup(function(){p1Trait1a1=document.getElementById("p1t1a1").value;p1Trait1a1=m(p1Trait1a1);parentAlleles1["11"]=p1Trait1a1;h()});a("#p1t1a2").keyup(function(){p1Trait1a2=document.getElementById("p1t1a2").value;p1Trait1a2=m(p1Trait1a2);parentAlleles1["12"]=p1Trait1a2;h()});a("#p1t2a1").keyup(function(){p1Trait2a1=document.getElementById("p1t2a1").value;p1Trait2a1=m(p1Trait2a1);parentAlleles1["21"]=p1Trait2a1;h()});a("#p1t2a2").keyup(function(){p1Trait2a2=document.getElementById("p1t2a2").value;p1Trait2a2=m(p1Trait2a2);parentAlleles1["22"]=p1Trait2a2;h()});a("#p1t3a1").keyup(function(){p1Trait3a1=document.getElementById("p1t3a1").value;p1Trait3a1=m(p1Trait3a1);parentAlleles1["31"]=p1Trait3a1;h()});a("#p1t3a2").keyup(function(){p1Trait3a2=document.getElementById("p1t3a2").value;p1Trait3a2=m(p1Trait3a2);parentAlleles1["32"]=p1Trait3a2;h()});a("#p1t4a1").keyup(function(){p1Trait4a1=document.getElementById("p1t4a1").value;p1Trait4a1=m(p1Trait4a1);parentAlleles1["41"]=p1Trait4a1;h()});a("#p1t4a2").keyup(function(){p1Trait4a2=document.getElementById("p1t4a2").value;p1Trait4a2=m(p1Trait4a2);parentAlleles1["42"]=p1Trait4a2;h()});a("#p1t5a1").keyup(function(){p1Trait5a1=document.getElementById("p1t5a1").value;p1Trait5a1=m(p1Trait5a1);parentAlleles1["51"]=p1Trait5a1;h()});a("#p1t5a2").keyup(function(){p1Trait5a2=document.getElementById("p1t5a2").value;p1Trait5a2=m(p1Trait5a2);parentAlleles1["52"]=p1Trait5a2;h()});a("#p2t1a1").keyup(function(){p2Trait1a1=document.getElementById("p2t1a1").value;p2Trait1a1=m(p2Trait1a1);parentAlleles2["11"]=p2Trait1a1;h()});a("#p2t1a2").keyup(function(){p2Trait1a2=document.getElementById("p2t1a2").value;p2Trait1a2=m(p2Trait1a2);parentAlleles2["12"]=p2Trait1a2;h()});a("#p2t2a1").keyup(function(){p2Trait2a1=document.getElementById("p2t2a1").value;p2Trait2a1=m(p2Trait2a1);parentAlleles2["21"]=p2Trait2a1;h()});a("#p2t2a2").keyup(function(){p2Trait2a2=document.getElementById("p2t2a2").value;p2Trait2a2=m(p2Trait2a2);parentAlleles2["22"]=p2Trait2a2;h()});a("#p2t3a1").keyup(function(){p2Trait3a1=document.getElementById("p2t3a1").value;p2Trait3a1=m(p2Trait3a1);parentAlleles2["31"]=p2Trait3a1;h()});a("#p2t3a2").keyup(function(){p2Trait3a2=document.getElementById("p2t3a2").value;p2Trait3a2=m(p2Trait3a2);parentAlleles2["32"]=p2Trait3a2;h()});a("#p2t4a1").keyup(function(){p2Trait4a1=document.getElementById("p2t4a1").value;p2Trait4a1=m(p2Trait4a1);parentAlleles2["41"]=p2Trait4a1;h()});a("#p2t4a2").keyup(function(){p2Trait4a2=document.getElementById("p2t4a2").value;p2Trait4a2=m(p2Trait4a2);parentAlleles2["42"]=p2Trait4a2;h()});a("#p2t5a1").keyup(function(){p2Trait5a1=document.getElementById("p2t5a1").value;p2Trait5a1=m(p2Trait5a1);parentAlleles2["51"]=p2Trait5a1;h()});a("#p2t5a2").keyup(function(){p2Trait5a2=document.getElementById("p2t5a2").value;p2Trait5a2=m(p2Trait5a2);parentAlleles2["52"]=p2Trait5a2;h()});a("#showGeno").click(function(){if(e==0){e=1;document.getElementById("showGeno").innerHTML="Hide Frequencies"}else{e=0;document.getElementById("showGeno").innerHTML="Show Frequencies"}h()})})(jQuery)